id: dang_ky_thuong_tru_hoan_chinh.v1
version: "1.0"
effective_date: "2025-10-01"
scope: "K?ch b?n hoàn ch?nh, s? d?ng chu?i câu h?i logic d? t? d?ng phân lo?i và hu?ng d?n chi ti?t th? t?c dang ký thu?ng trú theo t?ng tru?ng h?p c? th?."

# === KHAI BÁO INTENT VÀ SYNONYMS ===
intents:
  - id: dang_ky_thuong_tru
    synonyms:
      - "dang ký thu?ng trú"
      - "nh?p h? kh?u"
      - "dang ký h? kh?u m?i"
      - "th? t?c thu?ng trú"
      - "làm h? kh?u"
      - "tôi mu?n dang ký cho con ? v?i cha, m?"
      - "tôi mu?n dang ký nh?p v? nhà ch?ng"
      - "tôi mu?n dang ký cho con v? ? chung v?i ông, bà"
      - "th? t?c nh?p v? h?"
      - "nh?p con v? ? v?i cha m?"

# === CHU?I CÂU H?I PHÂN LO?I T? Ð?NG ===
slots:
  - name: chu_the_dang_ky
    question: |
      Chào anh/ch?. Ð? hu?ng d?n th? t?c dang ký thu?ng trú, tru?c h?t, xin cho bi?t anh/ch? dang làm th? t?c cho ai ??
      1. Cho chính b?n thân anh/ch?.
      2. Cho con cái.
      3. Cho v? ho?c ch?ng.
    required: true
    type: choice
    choices: ["1", "2", "3"]
    
  - name: con_tren_18_tuoi
    question: "D?, cho h?i ngu?i con anh/ch? dang ký là trên hay du?i 18 tu?i ??"
    required: true
    type: choice
    choices: ["Trên 18 tu?i", "Du?i 18 tu?i"]
    condition: "chu_the_dang_ky == '2'" # Ch? h?i khi dang ký cho con

  - name: chu_so_huu_la_ai
    question: "C?m on anh/ch?. Ti?p theo, xin cho bi?t ngôi nhà/can h? này thu?c s? h?u c?a ai ?? (Ví d?: c?a tôi, c?a ch?ng tôi, c?a ba m? tôi...)"
    required: true
    type: text

# === HU?NG D?N H? SO TUONG ?NG VÀ B?T Ð?U LU?NG CHUNG ===
final_response: |
  C?m on anh/ch?. D?a vào các thông tin dã thu th?p, dây là danh sách gi?y t? c?n chu?n b? (du?i d?ng b?n ch?p ho?c scan):

  {% set chu_the = chu_the_dang_ky %}
  {% set chu_so_huu = chu_so_huu_la_ai | lower %}

  {# TRU?NG H?P 1: ÐANG KÝ V? NHÀ C?A CHÍNH MÌNH (THEO KHO?N 1, ÐI?U 20 & ÐI?U 21 LU?T CU TRÚ) #}
  {% if ('tôi' in chu_so_huu or 'mình' in chu_so_huu or 'b?n thân' in chu_so_huu) and chu_the == '1' %}
  **Tru?ng h?p: Ðang ký t?i ch? ? thu?c quy?n s? h?u c?a mình**
  - **1. T? khai thay d?i thông tin cu trú (M?u CT01)**.
  - **2. Gi?y t? ch?ng minh ch? ? h?p pháp:**
      - **N?u** Gi?y ch?ng nh?n (S? d?) c?a anh/ch? **có th? hi?n công trình là nhà ? trên d?t**, anh/ch? có th? dùng gi?y t? này.
      - **N?u** S? d? **ch? th? hi?n quy?n s? d?ng d?t**, anh/ch? c?n s? d?ng **M?u s? 02** (theo Ngh? d?nh 154/2024/NÐ-CP). M?u này ph?i du?c **?y ban nhân dân c?p xã** noi có d?t ký xác nh?n.

  {# TRU?NG H?P 2: CON V? V?I CHA M? (THEO ÐI?M A, KHO?N 2, ÐI?U 20 LU?T CU TRÚ) #}
  {% elif chu_the == '2' %}
    {% if con_tren_18_tuoi == 'Du?i 18 tu?i' %}
    **Tru?ng h?p: Ðang ký cho con (du?i 18 tu?i) v? v?i cha ho?c m?**
    - **1. T? khai thay d?i thông tin cu trú (M?u CT01)**: Do cha ho?c m? là ngu?i kê khai và ký tên.
    - **2. Gi?y t? ch?ng minh quan h? cha/m? - con**: Gi?y khai sinh c?a con.
    
    {% else %}
    **Tru?ng h?p: Ðang ký cho con (trên 18 tu?i) v? v?i cha ho?c m?**
    - **1. T? khai thay d?i thông tin cu trú (M?u CT01)**: Ph?i có d?y d? ý ki?n d?ng ý và ch? ký c?a **ch? h?** và **ch? s? h?u ch? ? h?p pháp**.
    - **2. Gi?y t? ch?ng minh quan h? cha/m? - con**: Gi?y khai sinh c?a ngu?i con.
    {% endif %}
  
  {# TRU?NG H?P 3: V?/CH?NG V? V?I NHAU (THEO ÐI?M A, KHO?N 2, ÐI?U 20 LU?T CU TRÚ) #}
  {% elif chu_the == '3' %}
  **Tru?ng h?p: V? nhà c?a v? ho?c ch?ng**
  - **1. T? khai thay d?i thông tin cu trú (M?u CT01)**, trong dó ngu?i v?/ch?ng là ch? h? ph?i ký tên d?ng ý ? m?c "Ý ki?n c?a ch? h?".
  - **2. Gi?y t? ch?ng minh quan h? v? ch?ng**: Gi?y ch?ng nh?n k?t hôn.
  
  {# TRU?NG H?P M?C Ð?NH KHÁC: THUÊ, MU?N, ? NH? #}
  {% else %}
  **Tru?ng h?p: V? nhà ngu?i khác (thuê, mu?n, ? nh?, h? hàng...)**
  - **1. T? khai CT01**, trong dó ch? h? và ch? s? h?u ch? ? h?p pháp ph?i ký tên d?ng ý.
  - **2. H?p d?ng cho thuê, cho mu?n, cho ? nh?** ho?c van b?n d?ng ý c?a ch? s? h?u (không b?t bu?c công ch?ng, ch?ng th?c d?i v?i dang ký t?m trú).
  - **3. Gi?y t? ch?ng minh ch? ? h?p pháp** c?a bên cho thuê/mu?n.
  {% endif %}

  ---
  Sau khi anh/ch? dã chu?n b? xong các gi?y t? trên, chúng ta s? b?t d?u th?c hi?n n?p h? so tr?c tuy?n.

# === LU?NG N?P H? SO TR?C TUY?N (DÙNG CHUNG) ===
guided_flows:
  - id: flow_nop_ho_so_thuong_tru_online
    entry_patterns: [] # Kích ho?t sau khi final_response hoàn t?t.
    confirm_keywords: ["xong", "ok", "r?i", "ti?p", "dã chu?n b? xong"]
    cancel_keywords: ["d?ng", "h?y"]
    steps:
      - id: b1_dang_nhap
        say: "B1) Truy c?p C?ng D?ch v? công B? Công an t?i: **dichvucong.bocongan.gov.vn** và **'Ðang nh?p'** b?ng tài kho?n VNeID."
        confirm: "Anh/ch? dã dang nh?p thành công chua?"
      - id: b2_tim_thu_tuc
        say: "B2) T?i ô tìm ki?m, gõ **'Ðang ký thu?ng trú'** và ch?n th? t?c hành chính tuong ?ng."
        confirm: "Anh/ch? dã tìm th?y và ch?n th? t?c chua?"
      - id: b3_ke_khai
        say: "B3) Ði?n d?y d? thông tin vào t? khai tr?c tuy?n (M?u CT01). Thông tin cá nhân s? du?c t? d?ng di?n."
        confirm: "Anh/ch? dã di?n xong t? khai chua?"
      - id: b4_tai_ho_so
        say: "B4) Ðính kèm các file ?nh ch?p ho?c b?n scan gi?y t? dã chu?n b? vào các m?c tuong ?ng."
        confirm: "Anh/ch? dã dính kèm d? h? so theo hu?ng d?n chua?"
      - id: b5_chon_co_quan
        say: "B5) Ch?n **Co quan th?c hi?n** là Công an c?p xã/phu?ng/th? tr?n noi anh/ch? mu?n dang ký thu?ng trú."
        confirm: "Anh/ch? dã ch?n xong co quan th?c hi?n chua?"
      - id: b6_nop_va_theo_doi
        say: "B6) Ki?m tra l?i toàn b? thông tin, n?p h? so và thanh toán l? phí (n?u có). Anh/ch? s? nh?n du?c mã h? so d? theo dõi ti?n d?."
      - id: b7_nhan_ket_qua
        say: "Sau kho?ng 5-7 ngày làm vi?c, anh/ch? s? nh?n du?c thông báo k?t qu? qua C?ng D?ch v? công ho?c tin nh?n SMS. Chúc anh/ch? th?c hi?n thành công!"

notes:
  - "Luu ý v? d?ng s? h?u (theo Ði?u 8, NÐ 154/2024/NÐ-CP): Ð?i v?i tru?ng h?p v?/ch?ng, cha/m?/con, ch? c?n s? d?ng ý c?a **01 d?ng s? h?u**. Các tru?ng h?p khác c?n s? d?ng ý c?a **T?T C?** d?ng s? h?u."
  - "T?t c? các gi?y t? ph?i du?c scan ho?c ch?p ?nh rõ nét, không b? m?, lóa."
  - "B?t bu?c ph?i có tài kho?n Ð?nh danh di?n t? (VNeID) m?c 2 d? dang nh?p và n?p h? so."